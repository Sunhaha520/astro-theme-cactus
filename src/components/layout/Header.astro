---
import { menuLinks } from "@/site-config";
import Search from "../Search.astro";
import ThemeToggle from "../ThemeToggle.astro";

const url = new URL(Astro.request.url);
---

<header class="group relative mb-28 flex items-center sm:ps-[4.5rem]" id="main-header">
 <div class="flex sm:flex-col">
  <a
   aria-current={url.pathname === "/" ? "page" : false}
   class="inline-flex items-center grayscale hover:filter-none sm:relative sm:inline-block"
   href="/"
  >
   <svg
    aria-hidden="true"
    class="me-3 h-10 w-6 sm:absolute sm:start-[-4.5rem] sm:me-0 sm:h-20 sm:w-12"
    fill="currentColor"
    focusable="false"
    viewBox="0 0 1024 1024"
    xmlns="http://www.w3.org/2000/svg"
   >
    <path d="M396.1856 574.8736c-29.5936 8.8064-42.5984-6.2464-42.5984-31.4368 0-21.9136 8.3968-43.3152 21.6064-58.7776 10.24-11.8784 24.064-20.992 38.2976-25.1904 13.2096-3.8912 23.3472-4.3008 28.3648-3.072l7.5776-23.2448c-4.1984-1.6384-16.2816-2.048-32.768 2.7648-21.6064 6.4512-40.3456 18.0224-55.9104 34.5088-21.8112 22.7328-35.2256 53.248-35.2256 84.3776 0 39.0144 24.9856 55.6032 63.8976 44.032 17.6128-5.3248 31.232-12.3904 39.2192-18.3296l-2.4576-20.48c-7.9872 6.3488-19.0464 11.6736-30.0032 14.848z m193.536-72.0896c0 21.8112 12.6976 33.1776 32.0512 27.4432 13.824-4.096 28.0576-15.2576 38.7072-38.5024l0.6144-0.2048c-0.9216 9.6256-1.8432 18.5344-1.9456 25.088l24.064-7.168c-0.4096-12.8 1.3312-33.5872 4.5056-50.7904l11.1616-59.904c-8.2944-0.3072-20.992 1.2288-32.768 4.8128-50.5856 15.0528-76.3904 62.1568-76.3904 99.2256z m74.3424-48.9472c-5.12 29.0816-19.7632 48.64-31.8464 52.224-11.3664 3.2768-15.5648-4.7104-15.5648-16.1792 0-24.6784 18.432-57.1392 42.5984-64.3072 4.7104-1.3312 7.9872-1.8432 10.752-2.048l-5.9392 30.3104z m-165.1712-0.6144c-36.9664 11.0592-62.6688 50.4832-62.6688 87.1424 0 25.8048 16.896 39.7312 44.2368 31.6416 36.9664-11.0592 62.7712-50.2784 62.7712-87.1424 0.2048-23.9616-15.1552-40.2432-44.3392-31.6416z m-14.6432 97.792c-13.1072 3.9936-21.0944-4.1984-21.0944-19.0464 0-20.2752 11.9808-51.5072 32.6656-57.6512 15.872-4.7104 20.6848 7.68 20.6848 18.8416 0 21.4016-12.9024 52.0192-32.256 57.856z m269.9264 309.76V221.0816c0-19.5584-31.1296-74.752-46.592-101.1712v-13.6192c5.9392-3.8912 9.6256-10.5472 9.6256-17.8176 0-11.5712-9.0112-21.1968-20.48-21.504-4.9152-0.3072-47.0016-2.9696-186.7776-2.9696-137.216 0-172.544 2.6624-177.4592 2.9696-11.1616 0.6144-20.48 9.9328-20.48 21.504 0 4.3008 1.6384 8.6016 3.9936 11.8784v19.5584c-15.4624 26.4192-46.592 81.6128-46.592 101.1712v645.7344l0.4096 1.6384 0.4096 1.3312s0.3072 1.024 0.3072 1.3312c0.4096 0.4096 0.4096 0.6144 0.6144 1.3312 0 0.4096 0.3072 0.6144 0.6144 1.024s0.4096 0.6144 0.6144 1.024l1.024 1.024 1.024 1.024 1.024 1.024s1.024 0.4096 1.3312 0.6144c0.4096 0.3072 0.6144 0.3072 0.6144 0.6144 1.9456 0.6144 11.5712 4.9152 28.3648 10.9568-1.3312 1.9456-1.9456 4.3008-1.9456 6.8608v22.8352c0 6.2464 3.8912 11.8784 10.24 13.5168 6.2464 1.6384 101.4784 27.136 211.2512 27.136 64.512 0 133.632-9.0112 192.7168-36.352 4.9152-2.3552 7.9872-7.2704 7.9872-12.4928v-17.6128c0-2.3552-0.6144-4.608-1.6384-6.656 7.2704-2.6624 14.5408-5.3248 22.1184-7.9872 7.0656-2.9696 10.4448-10.9568 7.68-18.2272zM726.4256 606.208c-12.4928-3.2768-25.8048-5.9392-39.936-7.9872-23.4496-2.6624-49.2544-3.2768-75.6736 0.6144-6.656 1.024-13.5168 1.9456-20.1728 3.6864-6.656 1.3312-13.312 3.2768-19.7632 5.3248-13.312 3.9936-26.4192 9.216-39.0144 15.4624-6.2464 2.9696-12.288 6.656-18.5344 9.9328-6.2464 3.2768-11.8784 7.2704-17.6128 11.1616-5.632 3.9936-11.5712 8.6016-17.2032 13.2096l-8.192 6.8608-6.656 5.9392c-8.2944 7.9872-16.4864 15.872-25.088 23.8592l-11.264 11.264-12.288 9.9328-11.8784 9.9328c-3.9936 2.9696-8.2944 5.9392-12.4928 9.0112-4.3008 2.9696-8.2944 5.9392-12.4928 9.0112l-12.9024 7.9872-12.9024 7.9872c-4.3008 2.3552-8.6016 4.608-12.9024 6.8608-4.3008 2.3552-8.6016 4.608-12.9024 6.656-4.7104 1.9456-9.0112 3.8912-13.2096 5.9392l-12.9024 5.632c-1.024 0.3072-2.3552 0.6144-3.2768 1.3312V406.528l15.2576-1.9456c5.632-1.024 10.9568-1.9456 16.4864-3.2768 5.632-1.024 11.1616-2.3552 16.7936-3.6864l16.896-5.3248c5.632-1.9456 11.5712-3.6864 17.2032-5.9392 5.632-2.3552 11.1616-4.7104 16.896-7.2704 5.632-2.6624 11.5712-4.7104 17.2032-7.5776 5.3248-3.2768 10.5472-6.2464 16.1792-9.6256 5.632-2.9696 11.1616-6.2464 16.4864-9.6256l15.4624-11.1616 15.4624-11.5712c4.9152-3.8912 9.6256-8.192 14.5408-12.4928l26.2144-24.7808 6.2464-5.9392 4.9152-4.3008c3.2768-2.9696 6.8608-5.9392 10.9568-8.6016 3.9936-2.9696 7.9872-5.9392 11.8784-8.6016s7.9872-5.632 12.288-7.5776c3.9936-2.6624 8.2944-4.9152 12.4928-6.8608 3.9936-2.3552 8.2944-4.3008 12.4928-5.9392 4.7104-1.9456 9.0112-3.9936 13.312-5.3248l6.8608-2.3552 6.656-1.9456c36.0448-10.9568 74.752-12.4928 108.4416-10.9568 0.6144 0.4096 1.024 0.4096 1.6384 0.4096v381.952z m-152.576-222.4128l-30.3104 167.2192 26.112-7.68 30.1056-167.1168-25.9072 7.5776z" p-id="25258"></path>
   </svg>
   <span class="text-xl font-bold sm:text-2xl">学术可乐罐</span>
  </a>
  <nav
   aria-label="Main menu"
   class="absolute -inset-x-4 top-14 hidden flex-col items-end gap-y-4 rounded-md bg-bgColor/[.85] py-4 text-accent shadow backdrop-blur group-[.menu-open]:z-50 group-[.menu-open]:flex sm:static sm:z-auto sm:-ms-4 sm:mt-1 sm:flex sm:flex-row sm:items-center sm:divide-x sm:divide-dashed sm:divide-accent sm:rounded-none sm:bg-transparent sm:py-0 sm:shadow-none sm:backdrop-blur-none"
   id="navigation-menu"
  >
   {
    menuLinks.map((link) => (
     <a
      aria-current={url.pathname === link.path ? "page" : false}
      class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline"
      data-astro-prefetch
      href={link.path}
     >
      {link.title}
     </a>
    ))
   }
  </nav>
 </div>
 <Search />
 <ThemeToggle />
 <mobile-button>
  <button
   aria-expanded="false"
   aria-haspopup="menu"
   aria-label="Open main menu"
   class="group relative ms-4 h-7 w-7 sm:invisible sm:hidden"
   id="toggle-navigation-menu"
   type="button"
  >
   <svg
    aria-hidden="true"
    class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 transition-all group-aria-expanded:scale-0 group-aria-expanded:opacity-0"
    fill="none"
    focusable="false"
    id="line-svg"
    stroke="currentColor"
    stroke-width="1.5"
    viewBox="0 0 24 24"
    xmlns="http://www.w3.org/2000/svg"
   >
    <path d="M3.75 9h16.5m-16.5 6.75h16.5" stroke-linecap="round" stroke-linejoin="round"
    ></path>
   </svg>
   <svg
    aria-hidden="true"
    class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 scale-0 text-accent opacity-0 transition-all group-aria-expanded:scale-100 group-aria-expanded:opacity-100"
    class="text-accent"
    fill="none"
    focusable="false"
    id="cross-svg"
    stroke="currentColor"
    stroke-width="1.5"
    viewBox="0 0 24 24"
    xmlns="http://www.w3.org/2000/svg"
   >
    <path d="M6 18L18 6M6 6l12 12" stroke-linecap="round" stroke-linejoin="round"></path>
   </svg>
  </button>
 </mobile-button>
</header>

<style>
  /* Add this CSS to change the SVG color on hover */
  .group:hover .h-10 {
    color: red; /* Change to the desired hover color */
  }
</style>

<script>
 import { toggleClass } from "@/utils/domElement";

 class MobileNavBtn extends HTMLElement {
  #menuOpen: boolean = false;

  connectedCallback() {
   const headerEl = document.getElementById("main-header")!;
   const mobileButtonEl = this.querySelector<HTMLButtonElement>("button");

   mobileButtonEl?.addEventListener("click", () => {
    if (headerEl) toggleClass(headerEl, "menu-open");
    this.#menuOpen = !this.#menuOpen;
    mobileButtonEl.setAttribute("aria-expanded", this.#menuOpen.toString());
   });
  }
 }

 customElements.define("mobile-button", MobileNavBtn);
</script>
